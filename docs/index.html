<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Kelime Oyunu - Dairesel</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    primary: "#8B5CF6",
                    secondary: "#F472B6",
                    "background-light": "#F3F4F6",
                    "background-dark": "#1F2937",
                    "surface-light": "#FFFFFF",
                    "surface-dark": "#374151",
                    "text-light": "#111827",
                    "text-dark": "#F9FAFB",
                },
                fontFamily: {
                    display: ["Nunito", "sans-serif"],
                },
                borderRadius: {
                    DEFAULT: "12px",
                    'xl': "16px",
                    '2xl': "24px",
                },
                boxShadow: {
                    'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                    'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
                }
            },
        },
    };
</script>
<style>
    body { font-family: 'Nunito', sans-serif; min-height: max(884px, 100dvh); }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Animasyonlar */
    @keyframes popIn {
        0% { transform: scale(0.5); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }
    .animate-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

    .btn-disabled {
        opacity: 0.3;
        pointer-events: none;
        filter: grayscale(100%);
        transform: scale(0.9) !important;
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen flex items-center justify-center font-display transition-colors duration-300">

<div class="w-full max-w-md h-full min-h-screen sm:h-auto sm:min-h-[800px] bg-white dark:bg-gray-800 sm:rounded-[32px] sm:shadow-2xl overflow-hidden relative flex flex-col">
    
    <header class="pt-8 pb-4 px-6 flex flex-col items-center space-y-4 bg-white dark:bg-gray-800 z-10">
        <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white tracking-tight">Kelime Oyunu</h1>
        <div class="bg-primary bg-opacity-10 dark:bg-opacity-20 px-6 py-2 rounded-2xl flex items-center space-x-2">
            <span class="material-symbols-outlined text-primary text-xl">timer</span>
            <span id="timer" class="text-2xl font-bold text-primary tabular-nums">01:30</span>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto px-6 pb-24 scrollbar-hide flex flex-col">
        
        <div id="input-container" class="mt-6 mb-2 min-h-[80px] w-full flex flex-wrap justify-center items-center gap-2">
            <div class="w-14 h-14 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl flex items-center justify-center opacity-50"></div>
        </div>

        <div class="relative w-[320px] h-[320px] mx-auto flex items-center justify-center select-none my-4">
            <svg class="absolute inset-0 w-full h-full pointer-events-none z-10 overflow-visible" viewBox="0 0 320 320">
                <filter id="glow">
                    <feGaussianBlur result="coloredBlur" stdDeviation="2.5"></feGaussianBlur>
                    <feMerge>
                        <feMergeNode in="coloredBlur"></feMergeNode>
                        <feMergeNode in="SourceGraphic"></feMergeNode>
                    </feMerge>
                </filter>
                <path class="opacity-30" d="M 160 50 L 255 105 L 255 215" fill="none" stroke="#A78BFA" stroke-linecap="round" stroke-linejoin="round" stroke-width="20"></path>
                <path d="M 160 50 L 255 105 L 255 215" fill="none" filter="url(#glow)" stroke="#8B5CF6" stroke-linecap="round" stroke-linejoin="round" stroke-width="12"></path>
            </svg>
            
            <div class="absolute w-[260px] h-[260px] bg-gray-50 dark:bg-gray-700/30 border-4 border-gray-100 dark:border-gray-700 rounded-full -z-0"></div>
            
            <div class="absolute bottom-0 right-0 z-20">
                <button onclick="openJokerModal()" class="w-14 h-14 bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-300 dark:border-yellow-600/50 rounded-full shadow-lg active:scale-95 transition-transform flex items-center justify-center text-yellow-600 dark:text-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-900/50">
                    <span class="material-symbols-outlined text-2xl">lightbulb</span>
                </button>
            </div>
            
            <div class="absolute bottom-0 left-0 z-20">
                <button onclick="shuffleLetters()" class="w-14 h-14 bg-white dark:bg-surface-dark border-2 border-gray-200 dark:border-gray-600 rounded-full shadow-lg active:scale-95 transition-transform flex items-center justify-center text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary">
                    <span class="material-symbols-outlined text-2xl">shuffle</span>
                </button>
            </div>

            <div id="circle-container" class="absolute inset-0 z-10">
                </div>
        </div>

        <div class="flex space-x-4 mb-8">
            <button onclick="clearInput()" class="flex-1 py-3 px-4 rounded-xl font-bold text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors active:scale-95 shadow-sm">
                Temizle
            </button>
            <button onclick="submitWord()" class="flex-[2] py-3 px-4 rounded-xl font-bold text-white bg-primary shadow-lg shadow-purple-500/30 hover:bg-purple-600 active:scale-95 transition-all flex items-center justify-center space-x-2">
                <span>Kelimeyi Kaydet</span>
                <span class="material-symbols-outlined text-sm">check_circle</span>
            </button>
        </div>

        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-3xl p-6 border border-gray-100 dark:border-gray-700 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-700 dark:text-gray-200">Bulunan Kelimeler</h2>
                <span id="word-count-badge" class="bg-primary/10 text-primary text-xs font-bold px-2 py-1 rounded-lg">0 Adet</span>
            </div>
            <div id="found-words-list" class="flex flex-wrap gap-3">
                <div class="w-full text-center text-gray-400 text-sm py-2 italic">Henüz kelime yok...</div>
            </div>
        </div>
    </main>

    <nav class="absolute bottom-0 w-full bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 px-6 py-3 flex justify-between items-center z-20">
        <button class="flex flex-col items-center space-y-1 text-primary">
            <span class="material-symbols-outlined text-2xl">grid_view</span>
            <span class="text-[10px] font-bold">Oyun</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">
            <span class="material-symbols-outlined text-2xl">leaderboard</span>
            <span class="text-[10px] font-bold">Skor</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">
            <span class="material-symbols-outlined text-2xl">settings</span>
            <span class="text-[10px] font-bold">Ayarlar</span>
        </button>
    </nav>

    <div id="joker-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[80vh]">
            <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">Joker Harf Seç</h3>
                <button onclick="closeJokerModal()" class="text-gray-400 hover:text-gray-600"><span class="material-symbols-outlined">close</span></button>
            </div>
            <div class="p-4 overflow-y-auto">
                <div id="alphabet-grid" class="grid grid-cols-6 gap-2">
                    </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Config & State ---
    const GAME_DURATION = 90; 
    const LETTER_COUNT = 6; // Daire için ideal sayı 6'dır
    const RADIUS = 110; // Harflerin merkeze uzaklığı
    const VOWELS = "AEIİOÖUÜ";
    const CONSONANTS = "BCÇDFGĞHJKLMNPRSŞTVYZ";
    const FULL_ALPHABET = "ABCÇDEFGĞHIİJKLMNOÖPRSŞTUÜVYZ";
    
    let timerInterval;
    let timeRemaining = GAME_DURATION;
    let currentLetters = []; // {char: 'A', id: 0, state: 'active'|'disabled'}
    let currentInputSequence = []; // {char: 'A', sourceId: 0, type: 'circle'|'joker'}
    let foundWords = [];

    // --- DOM Elements ---
    const timerEl = document.getElementById('timer');
    const circleContainerEl = document.getElementById('circle-container');
    const inputContainerEl = document.getElementById('input-container');
    const foundListEl = document.getElementById('found-words-list');
    const countBadgeEl = document.getElementById('word-count-badge');
    const modalEl = document.getElementById('joker-modal');
    const alphabetGridEl = document.getElementById('alphabet-grid');

    // --- Initialization ---
    function initGame() {
        populateJokerModal();
        startRound();
    }

    function startRound() {
        timeRemaining = GAME_DURATION;
        currentInputSequence = [];
        foundWords = [];
        
        generateRandomLetters();
        renderCircle();
        renderInput();
        renderFoundWords();
        updateTimerDisplay();
        
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();
            if (timeRemaining <= 0) endRound();
        }, 1000);
    }

    function endRound() {
        clearInterval(timerInterval);
        timerEl.classList.add('text-red-500');
        setTimeout(() => {
            alert("Süre doldu! Yeni kelimeler geliyor...");
            timerEl.classList.remove('text-red-500');
            startRound();
        }, 100);
    }

    // --- Game Logic ---
    function generateRandomLetters() {
        currentLetters = [];
        for (let i = 0; i < LETTER_COUNT; i++) {
            let char;
            // İlk 2 harf sesli, kalanı sessiz olsun (dengeli dağılım)
            if (i < 2) char = VOWELS[Math.floor(Math.random() * VOWELS.length)];
            else char = CONSONANTS[Math.floor(Math.random() * CONSONANTS.length)];
            
            currentLetters.push({
                char: char,
                id: i,
                state: 'active'
            });
        }
        // Shuffle initially so vowels aren't always first
        currentLetters.sort(() => Math.random() - 0.5);
        // Fix IDs after shuffle to match position indices if needed, 
        // but here we keep original ID to track usage status.
    }

    function renderCircle() {
        circleContainerEl.innerHTML = '';
        const angleStep = 360 / LETTER_COUNT;

        currentLetters.forEach((item, index) => {
            // Calculate Position
            // Start from -90deg (Top)
            const angleDeg = (index * angleStep) - 90; 
            
            // Create Button
            const btn = document.createElement('button');
            
            // Base Styles
            let className = "absolute w-20 h-20 rounded-full shadow-md transition-all duration-300 flex items-center justify-center text-3xl font-extrabold z-10 ";
            
            if (item.state === 'disabled') {
                className += "bg-gray-200 dark:bg-gray-700 text-gray-400 border-2 border-gray-300 btn-disabled ";
            } else {
                className += "bg-white dark:bg-surface-dark border-2 border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:border-primary hover:text-primary active:scale-90 ";
            }

            btn.className = className;
            btn.innerText = item.char;
            
            // Apply Transform for Circular Layout
            // Rotate container to angle -> push out by radius -> rotate text back
            // Note: We use inline style for dynamic values
            btn.style.left = "50%";
            btn.style.top = "50%";
            btn.style.transform = `translate(-50%, -50%) rotate(${angleDeg}deg) translate(${RADIUS}px) rotate(${-angleDeg}deg)`;

            if (item.state === 'active') {
                btn.onclick = () => handleLetterClick(item);
            }

            circleContainerEl.appendChild(btn);
        });
    }

    function renderInput() {
        inputContainerEl.innerHTML = '';
        
        // Render current letters
        currentInputSequence.forEach(item => {
            const box = document.createElement('div');
            // If it's a Joker, make it yellow-ish/Primary distinct
            const isJoker = item.type === 'joker';
            const bgClass = isJoker ? 'bg-yellow-400 text-white border-yellow-500' : 'bg-primary text-white border-transparent';
            
            box.className = `w-14 h-14 ${bgClass} rounded-2xl flex items-center justify-center text-3xl font-bold shadow-lg shadow-purple-500/30 animate-pop border-2`;
            box.innerText = item.char;
            
            // Clicking an input letter removes it (Backspace functionality on click)
            box.onclick = () => removeLetter(item);
            box.style.cursor = 'pointer';
            
            inputContainerEl.appendChild(box);
        });

        // Always show one empty placeholder at the end
        const placeholder = document.createElement('div');
        placeholder.className = "w-14 h-14 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl flex items-center justify-center opacity-50";
        inputContainerEl.appendChild(placeholder);
    }

    function handleLetterClick(item) {
        if (item.state === 'disabled') return;

        // Add to sequence
        currentInputSequence.push({
            char: item.char,
            sourceId: item.id,
            type: 'circle'
        });

        // Mark as disabled
        const letterObj = currentLetters.find(l => l.id === item.id);
        if (letterObj) letterObj.state = 'disabled';

        renderCircle();
        renderInput();
    }

    function removeLetter(itemToRemove) {
        // We need to remove this specific item and all after it? 
        // Or just this one? Standard behavior is usually "Backspace" (last one).
        // But clicking a specific box suggests removing just that one.
        // For simplicity and stability, let's implement "Remove this and shift left".
        
        // Find index
        const idx = currentInputSequence.indexOf(itemToRemove);
        if (idx === -1) return;

        // Remove from sequence
        currentInputSequence.splice(idx, 1);

        // Re-enable in circle if it was a circle letter
        if (itemToRemove.type === 'circle') {
            const letterObj = currentLetters.find(l => l.id === itemToRemove.sourceId);
            if (letterObj) letterObj.state = 'active';
        }

        renderCircle();
        renderInput();
    }

    function clearInput() {
        // Re-enable all currently selected circle letters
        currentInputSequence.forEach(item => {
            if (item.type === 'circle') {
                const letterObj = currentLetters.find(l => l.id === item.sourceId);
                if (letterObj) letterObj.state = 'active';
            }
        });
        currentInputSequence = [];
        renderCircle();
        renderInput();
    }

    function submitWord() {
        if (currentInputSequence.length < 2) return;

        const word = currentInputSequence.map(i => i.char).join('');
        foundWords.push(word);
        
        // Reset Logic: 
        // The prompt says "used letters enabled when word saved".
        // This implies we start fresh for the next word.
        
        // 1. Clear input
        currentInputSequence = [];
        
        // 2. Re-enable ALL letters in the circle
        currentLetters.forEach(l => l.state = 'active');

        renderCircle();
        renderInput();
        renderFoundWords();
    }

    function shuffleLetters() {
        // Sadece input boşsa karıştırılabilir (UX tercihi)
        if (currentInputSequence.length > 0) {
            // Optional: Shake animation or deny
            return;
        }
        
        // Fisher-Yates Shuffle
        for (let i = currentLetters.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [currentLetters[i], currentLetters[j]] = [currentLetters[j], currentLetters[i]];
        }
        
        renderCircle();
    }

    function renderFoundWords() {
        countBadgeEl.innerText = `${foundWords.length} Adet`;
        if (foundWords.length === 0) {
            foundListEl.innerHTML = '<div class="w-full text-center text-gray-400 text-sm py-2 italic">Henüz kelime yok...</div>';
            return;
        }
        foundListEl.innerHTML = '';
        foundWords.slice().reverse().forEach(word => {
            const div = document.createElement('div');
            div.className = "px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 font-bold rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm animate-pop uppercase";
            div.innerText = word;
            foundListEl.appendChild(div);
        });
    }

    function updateTimerDisplay() {
        const m = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
        const s = (timeRemaining % 60).toString().padStart(2, '0');
        timerEl.innerText = `${m}:${s}`;
    }

    // --- Joker Modal ---
    function populateJokerModal() {
        alphabetGridEl.innerHTML = '';
        for (let char of FULL_ALPHABET) {
            const btn = document.createElement('button');
            btn.className = 'aspect-square bg-gray-50 dark:bg-gray-700 rounded-lg font-bold text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white transition-colors';
            btn.innerText = char;
            btn.onclick = () => selectJoker(char);
            alphabetGridEl.appendChild(btn);
        }
    }

    function openJokerModal() { modalEl.classList.remove('hidden'); }
    function closeJokerModal() { modalEl.classList.add('hidden'); }

    function selectJoker(char) {
        currentInputSequence.push({
            char: char,
            sourceId: -1,
            type: 'joker'
        });
        renderInput();
        closeJokerModal();
    }

    window.onload = initGame;
</script>
</body>
</html>

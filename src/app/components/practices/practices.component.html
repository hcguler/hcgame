<div class="game-container">
    <!-- Header -->
    <header class="game-header">
        <div class="header-box target-box">
            <span class="label">Target</span>
            <span class="value">{{ targetNumber }}</span>
        </div>
        <div class="header-box time-box">
            <span class="label">Time</span>
            <span class="value" [class.warning]="timeLeft <= 30">{{ formatTime(timeLeft) }}</span>
        </div>
    </header>

    <!-- Actions -->
    <div class="actions-bar">
        <button class="action-btn clear-btn" (click)="clearAll()">
            Clear
        </button>
        <button class="action-btn undo-btn" (click)="undoLastAction()" [disabled]="historyStack.length === 0">
            <span>â†¶</span> Undo
        </button>
    </div>

    <!-- Source Numbers -->
    <div class="source-numbers-area">
        <button
                *ngFor="let num of sourceNumbers"
                class="number-card source-card"
                [class.used]="num.isUsed"
                [disabled]="num.isUsed"
                (click)="onSourceNumberClick(num)">
            {{ num.value }}
        </button>
    </div>

    <!-- Calculation Grid -->
    <div class="calculation-grid">
        <div class="calc-row" *ngFor="let row of calculationRows; let i = index">

            <!-- Left Operand -->
            <div class="operand-box"
                 [class.empty]="!row.leftOperand"
                 [class.filled]="row.leftOperand"
                 [class.active-target]="isNextTarget(i, 'left')"
                 (click)="onOperandClick(i, 'left')">
                {{ row.leftOperand?.value }}
            </div>

            <!-- Operators -->
            <div class="operator-group">
                <button class="op-radio" [class.selected]="row.operator === '+'" (click)="setOperator(i, '+')">+</button>
                <button class="op-radio" [class.selected]="row.operator === '-'" (click)="setOperator(i, '-')">-</button>
                <button class="op-radio" [class.selected]="row.operator === '*'" (click)="setOperator(i, '*')">Ã—</button>
                <button class="op-radio" [class.selected]="row.operator === '/'" (click)="setOperator(i, '/')">Ã·</button>
            </div>

            <!-- Right Operand -->
            <div class="operand-box"
                 [class.empty]="!row.rightOperand"
                 [class.filled]="row.rightOperand"
                 [class.active-target]="isNextTarget(i, 'right')"
                 (click)="onOperandClick(i, 'right')">
                {{ row.rightOperand?.value }}
            </div>

            <!-- Equals -->
            <div class="equals-sign">=</div>

            <!-- Result (YENÄ°: [class.used] eklendi) -->
            <div class="result-box"
                 [class.has-result]="row.result !== null"
                 [class.used]="row.isResultUsed"
                 (click)="onResultClick(i)">
                {{ row.result }}
            </div>
        </div>
    </div>

    <!-- Score -->
    <div class="score-section">
        <div class="score-box">
            <span class="label">Toplam Puan:</span>
            <span class="value">{{ currentScore }}</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="game-footer">
        <button class="footer-btn new-game" (click)="resetGame()">
            Yeni Oyun
        </button>
        <button class="footer-btn back-home" routerLink="/">
            Back to Home
        </button>
    </footer>

    <!-- Modals -->
    <div class="dialog-overlay" *ngIf="showSuccessDialog || (isGameOver && timeLeft === 0 && !showSuccessDialog)">

        <!-- SUCCESS / PARTIAL SUCCESS DIALOG -->
        <div class="dialog-content success" *ngIf="showSuccessDialog">
            <h2 *ngIf="scoreDetails.distance === 0">ğŸ‰ MÃ¼kemmel!</h2>
            <h2 *ngIf="scoreDetails.distance > 0">ğŸ˜… YaklaÅŸtÄ±n!</h2>

            <div class="score-breakdown">
                <p>Hedef: <strong>{{ targetNumber }}</strong></p>
                <p *ngIf="scoreDetails.distance > 0">Fark: <span class="minus">-{{ scoreDetails.distance }}</span></p>

                <div class="breakdown-list">
                    <div class="b-item">
                        <span>Ä°sabet PuanÄ±:</span>
                        <span>{{ scoreDetails.base }}</span>
                    </div>
                    <div class="b-item">
                        <span>SÃ¼re Bonusu:</span>
                        <span>+{{ scoreDetails.timeBonus }}</span>
                    </div>
                    <div class="b-item">
                        <span>Verimlilik:</span>
                        <span>+{{ scoreDetails.opsBonus }}</span>
                    </div>
                    <div class="b-total">
                        <span>TOPLAM:</span>
                        <span>{{ scoreDetails.total }}</span>
                    </div>
                </div>
            </div>

            <button (click)="resetGame()">Yeni Oyun</button>
        </div>

        <!-- GAME OVER DIALOG -->
        <div class="dialog-content fail" *ngIf="isGameOver && !showSuccessDialog">
            <h2>â±ï¸ SÃ¼re Doldu!</h2>
            <p>Hedef sayÄ±ya ({{ targetNumber }}) veya yakÄ±nÄ±na ulaÅŸamadÄ±n.</p>
            <button (click)="resetGame()">Tekrar Dene</button>
        </div>
    </div>
</div>